/**
 * Beacon Tracking Script v1.0.0 | (c) Hype Insight | beacon-tracking.com/license
 */
!function(e,t){"use strict";const n="1.0.0",o=e.beaconConfig?.endpoint||"http://localhost:3000/api/track",i=e.beaconConfig?.batchEndpoint||"http://localhost:3000/api/track/batch",r="_beacon_";let a=!1,s=null,c=null,u=null,l=0,d=0,p=[],f=null,m=Date.now(),g=Date.now(),v=!1;function h(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function w(){const e=r+"client_id";let t=localStorage.getItem(e);return t||(t=h(),localStorage.setItem(e,t),v=!0),t}function b(){const e=r+"session_id",t=r+"session_time",n=r+"session_number",o=parseInt(localStorage.getItem(t)||"0");if(Date.now()-o>18e5){const t=h(),o=parseInt(localStorage.getItem(n)||"0")+1;return localStorage.setItem(e,t),localStorage.setItem(n,o.toString()),l=o,t}let i=localStorage.getItem(e);return i?l=parseInt(localStorage.getItem(n)||"1"):(i=h(),localStorage.setItem(e,i),localStorage.setItem(n,"1"),l=1),i}function y(){const e=r+"session_time";localStorage.setItem(e,Date.now().toString()),g=Date.now()}function S(){const e=new URLSearchParams(e.location.search),t={utm_source:e.get("utm_source")||sessionStorage.getItem(r+"utm_source"),utm_medium:e.get("utm_medium")||sessionStorage.getItem(r+"utm_medium"),utm_campaign:e.get("utm_campaign")||sessionStorage.getItem(r+"utm_campaign"),utm_term:e.get("utm_term")||sessionStorage.getItem(r+"utm_term"),utm_content:e.get("utm_content")||sessionStorage.getItem(r+"utm_content"),gclid:e.get("gclid")||sessionStorage.getItem(r+"gclid"),fbclid:e.get("fbclid")||sessionStorage.getItem(r+"fbclid"),ttclid:e.get("ttclid")||sessionStorage.getItem(r+"ttclid")};return Object.keys(t).forEach((e=>{t[e]&&sessionStorage.setItem(r+e,t[e])})),t}function I(t,n={}){const o=S(),i={screen_resolution:screen.width+"x"+screen.height,viewport_size:e.innerWidth+"x"+e.innerHeight,device_pixel_ratio:e.devicePixelRatio||1,language:navigator.language||navigator.userLanguage,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},r={page_url:e.location.href,page_path:e.location.pathname,page_title:t.title,page_hostname:e.location.hostname,page_referrer:t.referrer||null,referrer_hostname:t.referrer?new URL(t.referrer).hostname:null};return{event:t,siteId:s,clientId:c,sessionId:u,timestamp:Date.now(),scriptVersion:n,is_first_visit:v,session_number:l,page_view_number:d,properties:{...i,...r,...o,...n}}}function E(e){if(!navigator.sendBeacon){fetch(o+"/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),keepalive:!0}).catch((e=>console.error("Beacon tracking error:",e)));{const t=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(o+"/event",t)}}}function x(e){p.push(e),p.length>=10?L():f||(f=setTimeout(L,5e3))}function L(){if(0===p.length)return;const e=p.splice(0);clearTimeout(f),f=null,fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e}),keepalive:!0}).catch((e=>console.error("Beacon batch error:",e)))}function _(){d++;const e=I("page_view",{time_on_page_sec:0});x(e),y()}function k(e,t={}){if(!a)return void console.warn('Beacon not initialized. Call beacon("init", "SITE_ID") first.');const n=I(e,t);x(n),y()}let T=0;e.beacon=function(n,...o){switch(n){case"init":!function(t,n={}){if(a)return;s=t,c=w(),u=b(),a=!0,_(),e.addEventListener("scroll",(function(){const e=e.pageYOffset||t.documentElement.scrollTop,n=t.documentElement.scrollHeight-e.innerHeight,o=Math.floor(e/n*100);o>T&&(T=o,[25,50,75,100].includes(o)&&k("scroll",{scroll_depth_percent:o,scroll_depth_pixels:e}))}),{passive:!0}),t.addEventListener("click",(function(e){const t=e.target,n=t.tagName.toLowerCase();("a"===n||"button"===n)&&k("click",{element_type:n,element_text:t.textContent?.trim().substring(0,100),element_id:t.id||null,element_class:t.className||null,target_url:t.href||null})}),!0),t.addEventListener("submit",(function(e){const t=e.target;k("form_submit",{form_id:t.id||null,form_name:t.name||null,form_action:t.action||null})}),!0),e.addEventListener("beforeunload",(function(){const e=Math.floor((Date.now()-m)/1e3),t=I("page_unload",{time_on_page_sec:e,scroll_depth_percent:T});E(t),L()})),e.addEventListener("pagehide",(function(){const e=Math.floor((Date.now()-m)/1e3),t=I("page_unload",{time_on_page_sec:e,scroll_depth_percent:T});E(t),L()})),setInterval((function(){const e=Math.floor((Date.now()-m)/1e3);k("user_engagement",{engagement_time_msec:Date.now()-g,time_on_page_sec:e})}),1e4),["mousedown","keydown","scroll","touchstart"].forEach((e=>{t.addEventListener(e,y,{passive:!0})})),console.log("Beacon initialized:",{siteId:s,clientId:c,sessionId:u})}(o[0],o[1]);break;case"track":k(o[0],o[1]);break;default:console.warn("Unknown Beacon command:",n)}},e.beacon&&e.beacon.q&&e.beacon.q.forEach((t=>e.beacon(...t)))}(window,document);
